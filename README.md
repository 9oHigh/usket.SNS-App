# SNS APP
<div align=center style="display: flex; justify-content: center; align-items: center;flex-direction: column;">
    <div>
      <img src='https://img.shields.io/badge/Flutter-02569B?&logo=flutter&logoColor=white'>
      <img src='https://img.shields.io/badge/dart-%230175C2.svg?&logoColor=white'>
    </div>
    <div align="center">
        <img src="https://img.shields.io/badge/-ê°œë°œ ê¸°ê°„-000000?logoColor=white"/>
        <img src="https://img.shields.io/badge/2024.11.11 ~ 2024.11.21-F5F5F5?style=flat&labelColor=FFF5F5"/>
    </div>
</div>


## ğŸ“ƒ ëª©ì°¨ 
- [SNS APP](#sns-app)
  - [ğŸ“ƒ ëª©ì°¨](#-ëª©ì°¨)
  - [ğŸ’ í”„ë¡œì íŠ¸ ì†Œê°œ](#-í”„ë¡œì íŠ¸-ì†Œê°œ)
  - [ğŸ“± ìŠ¤í¬ë¦°ìƒ·](#-ìŠ¤í¬ë¦°ìƒ·)
  - [âš™ï¸ ì‚¬ìš©í•œ ê¸°ìˆ  ìŠ¤íƒ](#ï¸-ì‚¬ìš©í•œ-ê¸°ìˆ -ìŠ¤íƒ)
  - [ğŸ—ï¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°](#ï¸-ë””ë ‰í† ë¦¬-êµ¬ì¡°)
  - [ğŸš© ì„±ê³¼](#-ì„±ê³¼)
  - [ğŸ˜ íŒ€ì›](#-íŒ€ì›)

<br>

## ğŸ’ í”„ë¡œì íŠ¸ ì†Œê°œ
**"Firestoreì™€ Firebase Cloud Messaging, Cloud Functionsë¥¼ í™œìš©í•´ ì‹¤ì‹œê°„ ì•Œë¦¼ì„ ì œê³µí•˜ëŠ” SNS APP"**
- ì´ë¯¸ì§€ì™€ í•¨ê»˜ ê²Œì‹œë¬¼ì„ ì‘ì„±í•˜ê³ , ì‚¬ìš©ìë“¤ì˜ ëŒ“ê¸€ê³¼ ì¢‹ì•„ìš” ì´ë²¤íŠ¸ì— ëŒ€í•œ ì‹¤ì‹œê°„ ì•Œë¦¼ì„ ì œê³µí•˜ëŠ” ê°„ë‹¨í•œ SNS ì•±

<br>

## ğŸ“± ìŠ¤í¬ë¦°ìƒ·
<div align="center">
  <img src="assets/readme/screenshot3.png" width="500"/>
  &nbsp;&nbsp;&nbsp;
  <img src="assets/readme/screenshot2.png" width="500" alt="Image 2" />
  &nbsp;&nbsp;&nbsp;
  <img src="assets/readme/screenshot1.png" width="500" alt="Image 3" />
</div>

<br>

## âš™ï¸ ì‚¬ìš©í•œ ê¸°ìˆ  ìŠ¤íƒ
- ### Front
    <img src="https://github.com/flow2c/readme-template/blob/main/images/skills/Flutter.png?raw=true" width="70" alt="flutter" />
    &nbsp;&nbsp;&nbsp;
    <img src="https://github.com/flow2c/readme-template/blob/main/images/skills/Dart.png?raw=true" width="70" alt="dart" />
  
  | Package              | Purpose                                                            |
  | -------------------- | -------------------------------------------------------------------|
  | `flutter_riverpod`   | ìƒíƒœ ê´€ë¦¬ë¥¼ ìœ„í•´ ì‚¬ìš©                                                   |
  | `shared_preferences` | ê°„ë‹¨í•œ ë°ì´í„°ë¥¼ ë¡œì»¬ì— ì €ì¥í•˜ê¸° ìœ„í•´ ì‚¬ìš©(ë¡œê·¸ì¸ ìƒíƒœ, UserId ë“±)                |
  | `go_router`          | í™”ë©´ ì „í™˜ ê´€ë¦¬ë¥¼ ìœ„í•´ ì‚¬ìš©                                               |
  | `get_it`             | ì˜ì¡´ì„± ê´€ë¦¬ë¥¼ ìœ„í•´ ì‚¬ìš©                                                  |

  
- ### Back
    <img src="assets/readme/firebase_icon.png" width="80" alt="nodejs" />
    &nbsp;&nbsp;&nbsp;

  | Package              | Purpose                                                            |
  | -------------------- | -------------------------------------------------------------------|
  | `firebase_auth`      | Firebase Authenticationì„ ì´ìš©í•œ íšŒì›ê°€ì… ì§„í–‰ì„ ìœ„í•´ ì‚¬ìš©                 |
  | `cloud_firestore`| Firestoreë¥¼ ì´ìš©í•´ ì‚¬ìš©ì ì •ë³´, ê²Œì‹œê¸€, ì•Œë¦¼ ë“±ì˜ ë°ì´í„° ì €ì¥í•˜ê¸° ìœ„í•´ ì‚¬ìš©|
  | `firebase_messaging` | ì¢‹ì•„ìš”, ëŒ“ê¸€ ì•Œë¦¼ì„ ì‚¬ìš©ìì—ê²Œ ë³´ë‚´ê¸° ìœ„í•´ ì‚¬ìš©                              |
  | `cloud_functions` | ì¢‹ì•„ìš”, ëŒ“ê¸€ ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ê³ , Firestoreì— ë³€ê²½ì‚¬í•­ì„ ê°ì§€í•´ í•´ë‹¹ ì‚¬ìš©ìì—ê²Œ ì•Œë¦¼ì„ ë³´ë‚´ê¸° ìœ„í•´ ì‚¬ìš©|
  | `firebase_storage` |ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ ê²Œì‹œë¬¼ì˜ ì‚¬ì§„ì„ ì €ì¥í•˜ê³ , ê´€ë¦¬í•˜ê¸° ìœ„í•´ ì‚¬ìš©                      |
  

  <br>
- ### í˜‘ì—…ë„êµ¬
    <img src="https://github.com/flow2c/readme-template/blob/main/images/skills/GitLab.png?raw=true" width="70" alt="gitlab" />
    &nbsp;&nbsp;&nbsp;
    <img src="https://github.com/flow2c/readme-template/blob/main/images/skills/Notion.png?raw=true" width="70" alt="notion" />
    &nbsp;&nbsp;&nbsp;
    <img src="https://github.com/flow2c/readme-template/blob/main/images/skills/Discord.png?raw=true" width="70" alt="discord" />
    &nbsp;&nbsp;&nbsp;
<br>

## ğŸ—ï¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°
```
â”œâ”€â”€ core
â”‚   â”œâ”€â”€ constants
â”‚   â”‚   â”œâ”€â”€ colors.dart
â”‚   â”‚   â””â”€â”€ sizes.dart
â”‚   â”œâ”€â”€ di
â”‚   â”‚   â””â”€â”€ injector.dart
â”‚   â”œâ”€â”€ manager
â”‚   â”‚   â”œâ”€â”€ alert_manager.dart
â”‚   â”‚   â””â”€â”€ shared_preferences_manager.dart
â”‚   â””â”€â”€ router
â”‚       â””â”€â”€ router.dart
â”œâ”€â”€ data
â”‚   â”œâ”€â”€ datasources
â”‚   â”‚   â”œâ”€â”€ signin
â”‚   â”‚   â””â”€â”€ signup
â”‚   â”œâ”€â”€ models
â”‚   â”‚   â”œâ”€â”€ comment_model.dart
â”‚   â”‚   â”œâ”€â”€ notification_model.dart
â”‚   â”‚   â”œâ”€â”€ post_model.dart
â”‚   â”‚   â””â”€â”€ user_model.dart
â”‚   â””â”€â”€ repositories
â”‚       â”œâ”€â”€ signin
â”‚       â”œâ”€â”€ signup
â”‚       â””â”€â”€ user
â”œâ”€â”€ domain
â”‚   â”œâ”€â”€ repositories
â”‚   â”‚   â”œâ”€â”€ signin
â”‚   â”‚   â””â”€â”€ signup
â”‚   â””â”€â”€ usecases
â”‚       â”œâ”€â”€ signin
â”‚       â””â”€â”€ signup
â”œâ”€â”€ firebase_options.dart
â”œâ”€â”€ main.dart
â””â”€â”€ presentation
    â”œâ”€â”€ screens
    â”‚   â”œâ”€â”€ app
    â”‚   â”œâ”€â”€ create_post
    â”‚   â”œâ”€â”€ feed
    â”‚   â”œâ”€â”€ notification
    â”‚   â”œâ”€â”€ post_detail
    â”‚   â”œâ”€â”€ profile
    â”‚   â”œâ”€â”€ signin
    â”‚   â””â”€â”€ signup
    â””â”€â”€ widgets
        â”œâ”€â”€ bottom_nav_bar.dart
        â”œâ”€â”€ comment_card.dart
        â”œâ”€â”€ custom_appbar.dart
        â”œâ”€â”€ custom_floating_button.dart
        â”œâ”€â”€ gesture_button.dart
        â”œâ”€â”€ label_textfield.dart
        â””â”€â”€ post_card.dart
```

<br>

## ğŸš© ì„±ê³¼
* FCMê³¼ Cloud Functionsë¥¼ í†µí•´ ì‹¤ì‹œê°„ ì•Œë¦¼ì„ ì œê³µí•˜ëŠ” ë°©ë²•ì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.
  1. ì´ˆê¸°í™”
        ```dart
        Future<void> _initializeFCM() async {
        // ì•±ì´ ì‹¤í–‰ì¤‘ì´ ì•„ë‹ ê²½ìš°, ë©”ì„¸ì§€ë¥¼ ì²˜ë¦¬í•˜ëŠ” í•¸ë“¤ëŸ¬ë¥¼ ì¶”ê°€
        FirebaseMessaging.onBackgroundMessage(_firebaseMessagingBackgroundHandler);
        // Flutter Local Notificationì„ ì´ˆê¸°í™”
        final flutterLocalNotificationsPlugin = FlutterLocalNotificationsPlugin();
        // ì•ˆë“œë¡œì´ë“œ ì•Œë¦¼ ì±„ë„ ìƒì„± ( 8.0 ì´ìƒì—ì„œ í•„ìˆ˜ )
        await flutterLocalNotificationsPlugin
            .resolvePlatformSpecificImplementation<
                AndroidFlutterLocalNotificationsPlugin>()
            ?.createNotificationChannel(const AndroidNotificationChannel(
                'high_importance_channel', 'high_importance_notification',
                importance: Importance.max));
        await flutterLocalNotificationsPlugin.initialize(const InitializationSettings(
            android: AndroidInitializationSettings("@mipmap/ic_launcher")));
        // Foreground ìƒíƒœì—ì„œë„ í‘œì‹œí•˜ê¸° ìœ„í•œ ì˜µì…˜ ì„¤ì • 
        await FirebaseMessaging.instance.setForegroundNotificationPresentationOptions(
            alert: true, badge: true, sound: true);
        }
        ```
  2. Cloud Functionsë¥¼ ì´ˆê¸°í™”, index.js ì‘ì„±
    * ì˜ˆì‹œ ) ì¢‹ì•„ìš” ì´ë²¤íŠ¸ì— ëŒ€í•œ íŠ¸ë¦¬ê±°ë¥¼ ì„¤ì • ( firestoreì— document ìƒì„± )
        ```javaScript
        exports.sendLikeNotification = onDocumentCreated(
            "/posts/{postId}/likes/{uid}",
            async (event) => {
                /*
                [feed_notifier.dart]
                likeDocRef.set({
                    'userId': userId,
                    'likedAt': FieldValue.serverTimestamp(),
                    'nickname': nickname,
                });
                likesDocì— ìœ„ì˜ ì½”ë“œë¥¼ í†µí•´ ì¢‹ì•„ìš”ë¥¼ í´ë¦­í•œ ìœ ì €ê°€ ì¶”ê°€ëœë‹¤.
                */
                // event -> onDocumentCreated("/posts/{postId}/likes/{uid}")
                // event.parms -> { postId: ..., uid: ... }
                const postId = event.params.postId; 
                const uid = event.params.uid;
                /*
                "/posts/{postId}/likes/{uid}" ê²½ë¡œì— ìƒê¸´ ë°ì´í„°ë¥¼ ë§í•œë‹¤.
                event.data -> {
                    "userId": ...,
                    "likedAt": ...,
                    "nickname": ...
                }
                */
                const likeData = event.data.data();
                const postSnapshot = await admin.firestore().collection("posts").doc(postId).get();
                const post = postSnapshot.data();
                const authorId = post.uid;
                // ìì‹ ì´ ì‘ì„±í•œ ê²Œì‹œë¬¼ì— ì¢‹ì•„ìš”ë¥¼ ëˆŒë €ì„ ë•ŒëŠ” ì•Œë¦¼ ì²˜ë¦¬ X
                if (authorId === uid) {
                    return;
                }
                // ê²Œì‹œìì—ê²Œ ì•Œë¦¼ ë³´ë‚´ê¸°
                const userSnapshot = await admin.firestore().collection("users").doc(authorId).get();
                const authorData = userSnapshot.data();
                const token = authorData.fcmToken;
                const message = {
                    notification: {
                        title: "ìƒˆë¡œìš´ ì¢‹ì•„ìš”",
                        body: `${likeData.nickname}ë‹˜ì´ ê²Œì‹œë¬¼ì„ ì¢‹ì•„í•©ë‹ˆë‹¤.\ní™•ì¸í•´ë³´ì„¸ìš” :)`,
                    },
                    token: token,
                    // íƒ€ì…ì„ í†µí•´ ì•„ì´ì½˜ ì´ˆê¸°í™”
                    // IDë¥¼ í†µí•´ì„œ í™”ë©´ì „í™˜, ê²Œì‹œë¬¼ ë‚´ìš© í‘œì‹œ
                    data: {
                        type: "like",
                        postId: postId,
                    },
                };
                // FCMì´ ë©”ì„¸ì§€ë¥¼ ë³´ë‚´ëŠ” ì½”ë“œ
                await admin.messaging().send(message);

                const notification = {
                    type: "like",
                    postId: postId,
                    userId: uid,
                    message: `${likeData.nickname}ë‹˜ì´ ê²Œì‹œë¬¼ì„ ì¢‹ì•„í•©ë‹ˆë‹¤.`,
                    createdAt: admin.firestore.FieldValue.serverTimestamp(),
                };
                // firestoreì—ë„ userì˜ notification ì»¬ë ‰ì…˜ì— ì¶”ê°€í•´ì£¼ê¸°
                await admin.firestore().collection("users").doc(authorId).collection("notifications").add(notification);
            },
        );
        ```
    3. FCM ë¦¬ìŠ¤ë„ˆë¥¼ ì„¤ì •í•˜ê³ , ì²˜ë¦¬
     * appNotifier.dart ì—ì„œ ì•Œë¦¼ ìˆ˜ì‹ ì‹œ í™”ë©´ì— í‘œì‹œë  ì•Œë¦¼ ê°¯ìˆ˜ë¥¼ ìˆ˜ì •í•œë‹¤.
  
        ```dart
        FirebaseMessaging.onMessage.listen((RemoteMessage message) async {
            RemoteNotification? notification = message.notification;
            if (notification != null) {
                FlutterLocalNotificationsPlugin().show(
                    notification.hashCode,
                    notification.title,
                    notification.body,
                    const NotificationDetails(
                        android: AndroidNotificationDetails(
                        'high_importance_channel',
                        'high_importance_notification',
                        importance: Importance.max,
                    )));
                // ê°¯ìˆ˜ ì¶”ê°€ + ì €ì¥ ë°ì´í„° ì—…ë°ì´íŠ¸
                int count = state.notificationCount;
                state = state.copyWith(notificationCount: count + 1);
                SharedPreferenceManager()
                    .setPref<int>(PrefsType.unReadNotificationCount, count + 1);
            }
        });
        ```

## ğŸ˜ íŒ€ì›
  <table>
    <tr>
      <td>
      <a href="https://www.flaticon.com/kr/free-icons/" title="ì†Œë…€ ì•„ì´ì½˜ ì œì‘ì: Freepik - Flaticon">
      <img align=center src="assets/readme/woman_icon.png" width="100" height="100" alt="í”„ë¡œí•„ ì´ë¯¸ì§€">
      </td>
      <td width="300px">
        <a href="https://github.com/yuri-door">
          ì§„ìœ ë¦¬
        </a>
        <br />
        - í”„ë¡œí•„ í™”ë©´ & í”„ë¡œí•„ ìˆ˜ì • í™”ë©´ êµ¬í˜„<br>
        - ê²Œì‹œë¬¼ ìƒì„± í™”ë©´ êµ¬í˜„<br>
      </td>
      </a>
    </tr>
  </table>
  <table>
    <tr>
      <td>
      <a href="https://www.flaticon.com/kr/free-icons/" title="ë‚¨ì ì•„ì´ì½˜ ì œì‘ì: Freepik - Flaticon" target="_blank">
        <img 
          align="center" 
          src="assets/readme/man_icon.png" 
          width="100" 
          height="100" 
          alt="í”„ë¡œí•„ ì´ë¯¸ì§€"
        >
      </a>
      </td>
      <td width="400px">
        <a href="https://github.com/9oHigh">
          ì´ê²½í›„
        </a>
        <br />
        - íšŒì›ê°€ì… ë° ë¡œê·¸ì¸ í™”ë©´ ë° ê¸°ëŠ¥ êµ¬í˜„<br>
        - í”¼ë“œ í™”ë©´ ë° ê¸°ëŠ¥ êµ¬í˜„<br>
        - Firestore, cloud storage êµ¬ì¶•í•˜ê³  ê´€ë ¨ ë¡œì§ ì¶”ê°€(Create, Read)<br>
        - Cloud Functionsë¥¼ í†µí•´ ì•Œë¦¼ ìë™í™” êµ¬ì¶•<br>
      </td>
    </tr>
  </table>